# GPU é€‰æ‹©æŒ‡å— - IndexTTS é€‚é…å™¨

æœ¬æŒ‡å—å¸®åŠ©ä½ æ ¹æ®æ˜¾å¡å‹å·é€‰æ‹©æ­£ç¡®çš„é…ç½®æ–‡ä»¶ã€‚

## ğŸ¯ å¿«é€Ÿé€‰æ‹©

### å¦‚ä½•æŸ¥çœ‹ä½ çš„æ˜¾å¡å‹å·ï¼Ÿ

**Windows:**
```bash
nvidia-smi
```

**Linux:**
```bash
nvidia-smi
```

æŸ¥çœ‹è¾“å‡ºä¸­çš„ GPU åç§°ï¼Œä¾‹å¦‚ï¼š
- `NVIDIA GeForce RTX 4090` â†’ ä½¿ç”¨ **RTX 40 ç³»åˆ—é…ç½®**
- `NVIDIA GeForce RTX 5090` â†’ ä½¿ç”¨ **RTX 50 ç³»åˆ—é…ç½®**
- `NVIDIA GeForce RTX 3090` â†’ ä½¿ç”¨ **RTX 40 ç³»åˆ—é…ç½®**ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰

## ğŸ“‹ é…ç½®æ–‡ä»¶å¯¹ç…§è¡¨

| æ˜¾å¡ç³»åˆ— | å‹å·ç¤ºä¾‹ | Dockerfile | docker-compose æ–‡ä»¶ | æ„å»ºè„šæœ¬ |
|---------|---------|-----------|-------------------|---------|
| **RTX 50 ç³»åˆ—** | 5090, 5080 | `Dockerfile.5090` | `docker-compose-indextts-5090.yml` | `build-5090.sh/bat` |
| **RTX 40 ç³»åˆ—** | 4090, 4080, 4070 | `Dockerfile` | `docker-compose-indextts.yml` | `build.sh/bat` |
| **RTX 30 ç³»åˆ—** | 3090, 3080, 3070 | `Dockerfile` | `docker-compose-indextts.yml` | `build.sh/bat` |
| **RTX 20 ç³»åˆ—** | 2080 Ti, 2070 | `Dockerfile` | `docker-compose-indextts.yml` | `build.sh/bat` |

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### RTX 50 ç³»åˆ—ï¼ˆ5090, 5080 ç­‰ï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ CUDA 12.6
- æ›´å¤§çš„å…±äº«å†…å­˜ï¼ˆ16GBï¼‰
- é’ˆå¯¹ Blackwell æ¶æ„ä¼˜åŒ–

**éƒ¨ç½²å‘½ä»¤ï¼š**

**Windows:**
```bash
# 1. æ„å»ºé•œåƒ
cd index-tts-adapter
build-5090.bat

# 2. å¯åŠ¨æœåŠ¡
cd ..\deploy
docker-compose -f docker-compose-indextts-5090.yml up -d
```

**Linux/Mac:**
```bash
# 1. æ„å»ºé•œåƒ
cd index-tts-adapter
chmod +x build-5090.sh
./build-5090.sh

# 2. å¯åŠ¨æœåŠ¡
cd ../deploy
docker-compose -f docker-compose-indextts-5090.yml up -d
```

### RTX 40 ç³»åˆ—ï¼ˆ4090, 4080, 4070 ç­‰ï¼‰

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨ CUDA 12.1
- æ ‡å‡†å…±äº«å†…å­˜ï¼ˆ8GBï¼‰
- é’ˆå¯¹ Ada Lovelace æ¶æ„ä¼˜åŒ–

**éƒ¨ç½²å‘½ä»¤ï¼š**

**Windows:**
```bash
# 1. æ„å»ºé•œåƒ
cd index-tts-adapter
build.bat

# 2. å¯åŠ¨æœåŠ¡
cd ..\deploy
docker-compose -f docker-compose-indextts.yml up -d
```

**Linux/Mac:**
```bash
# 1. æ„å»ºé•œåƒ
cd index-tts-adapter
chmod +x build.sh
./build.sh

# 2. å¯åŠ¨æœåŠ¡
cd ../deploy
docker-compose -f docker-compose-indextts.yml up -d
```

### RTX 30 ç³»åˆ—åŠæ›´æ—©ï¼ˆ3090, 3080, 2080 Ti ç­‰ï¼‰

ä½¿ç”¨ä¸ RTX 40 ç³»åˆ—ç›¸åŒçš„é…ç½®ï¼ˆå‘ä¸‹å…¼å®¹ï¼‰ï¼š

**Windows:**
```bash
cd index-tts-adapter
build.bat
cd ..\deploy
docker-compose -f docker-compose-indextts.yml up -d
```

**Linux/Mac:**
```bash
cd index-tts-adapter
chmod +x build.sh
./build.sh
cd ../deploy
docker-compose -f docker-compose-indextts.yml up -d
```

## ğŸ”§ æŠ€æœ¯å·®å¼‚è¯´æ˜

### RTX 50 ç³»åˆ— vs RTX 40 ç³»åˆ—

| ç‰¹æ€§ | RTX 50 ç³»åˆ— | RTX 40 ç³»åˆ— |
|-----|-----------|-----------|
| **CUDA ç‰ˆæœ¬** | 12.6 | 12.1 |
| **æ¶æ„** | Blackwell | Ada Lovelace |
| **å…±äº«å†…å­˜** | 16GB | 8GB |
| **CUDA æ¶æ„ä»£ç ** | 9.0 | 8.9 |
| **ä¼˜åŒ–é€‰é¡¹** | `CUDA_MODULE_LOADING=LAZY` | æ ‡å‡† |

### ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†ï¼Ÿ

1. **CUDA ç‰ˆæœ¬å…¼å®¹æ€§**ï¼šRTX 50 ç³»åˆ—éœ€è¦æ›´æ–°çš„ CUDA ç‰ˆæœ¬
2. **æ¶æ„ä¼˜åŒ–**ï¼šä¸åŒæ¶æ„çš„ GPU æœ‰ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥
3. **å†…å­˜ç®¡ç†**ï¼šRTX 50 ç³»åˆ—æ”¯æŒæ›´å¤§çš„å…±äº«å†…å­˜
4. **æ€§èƒ½æœ€ä¼˜åŒ–**ï¼šä½¿ç”¨åŒ¹é…çš„é…ç½®å¯ä»¥è·å¾—æœ€ä½³æ€§èƒ½

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### RTX 5090 (æ¨èé…ç½®)

- **æ˜¾å­˜**: 24GB+
- **æ¨ç†é€Ÿåº¦**: ~0.5-1 ç§’/å¥ï¼ˆä¸­æ–‡ï¼‰
- **å¹¶å‘èƒ½åŠ›**: é«˜
- **æ¨èè®¾ç½®**: 
  - `use_fp16=True`
  - `shm_size=16g`

### RTX 4090 (æ¨èé…ç½®)

- **æ˜¾å­˜**: 24GB
- **æ¨ç†é€Ÿåº¦**: ~0.8-1.5 ç§’/å¥ï¼ˆä¸­æ–‡ï¼‰
- **å¹¶å‘èƒ½åŠ›**: ä¸­é«˜
- **æ¨èè®¾ç½®**: 
  - `use_fp16=True`
  - `shm_size=8g`

### RTX 3090 (æœ€ä½æ¨è)

- **æ˜¾å­˜**: 24GB
- **æ¨ç†é€Ÿåº¦**: ~1-2 ç§’/å¥ï¼ˆä¸­æ–‡ï¼‰
- **å¹¶å‘èƒ½åŠ›**: ä¸­
- **æ¨èè®¾ç½®**: 
  - `use_fp16=True` (å¿…é¡»)
  - `shm_size=8g`

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: æˆ‘ç”¨çš„æ˜¯ RTX 3090ï¼Œåº”è¯¥ç”¨å“ªä¸ªé…ç½®ï¼Ÿ

**ç­”**: ä½¿ç”¨ RTX 40 ç³»åˆ—çš„é…ç½®ï¼ˆ`docker-compose-indextts.yml`ï¼‰ï¼Œå®ƒå‘ä¸‹å…¼å®¹ã€‚

### Q2: æˆ‘ä¸ç¡®å®šæˆ‘çš„æ˜¾å¡æ˜¯å“ªä¸ªç³»åˆ—ï¼Ÿ

**ç­”**: è¿è¡Œ `nvidia-smi` æŸ¥çœ‹æ˜¾å¡å‹å·ï¼š
- å‹å·ä»¥ 50 å¼€å¤´ï¼ˆå¦‚ 5090ï¼‰â†’ RTX 50 ç³»åˆ—
- å‹å·ä»¥ 40 å¼€å¤´ï¼ˆå¦‚ 4090ï¼‰â†’ RTX 40 ç³»åˆ—
- å‹å·ä»¥ 30 å¼€å¤´ï¼ˆå¦‚ 3090ï¼‰â†’ RTX 30 ç³»åˆ—

### Q3: æˆ‘ç”¨é”™äº†é…ç½®ä¼šæ€æ ·ï¼Ÿ

**ç­”**: 
- å¦‚æœ RTX 50 ç”¨äº† 40 çš„é…ç½®ï¼šå¯èƒ½æ— æ³•å¯åŠ¨æˆ–æ€§èƒ½ä¸ä½³
- å¦‚æœ RTX 40 ç”¨äº† 50 çš„é…ç½®ï¼šå¯èƒ½æ— æ³•å¯åŠ¨ï¼ˆCUDA ç‰ˆæœ¬ä¸åŒ¹é…ï¼‰

### Q4: æˆ‘æœ‰å¤šå¼ ä¸åŒå‹å·çš„æ˜¾å¡æ€ä¹ˆåŠï¼Ÿ

**ç­”**: 
1. ä½¿ç”¨æœ€æ–°å‹å·å¯¹åº”çš„é…ç½®
2. åœ¨ docker-compose ä¸­æŒ‡å®šä½¿ç”¨å“ªå¼ æ˜¾å¡ï¼š
   ```yaml
   environment:
     - NVIDIA_VISIBLE_DEVICES=0  # ä½¿ç”¨ç¬¬ä¸€å¼ æ˜¾å¡
   ```

### Q5: å¦‚ä½•åˆ‡æ¢é…ç½®ï¼Ÿ

**ç­”**:
```bash
# åœæ­¢å½“å‰æœåŠ¡
docker-compose -f docker-compose-indextts.yml down

# å¯åŠ¨æ–°é…ç½®
docker-compose -f docker-compose-indextts-5090.yml up -d
```

## ğŸ” éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼š

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs -f duix-avatar-tts

# å¥åº·æ£€æŸ¥
curl http://127.0.0.1:18180/health

# é¢„æœŸè¾“å‡º
{
  "status": "healthy",
  "model_loaded": true
}
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´è¿ç§»æŒ‡å—](INDEXTTS_MIGRATION_GUIDE.md)
- [é€‚é…å™¨ä½¿ç”¨æ–‡æ¡£](index-tts-adapter/README.md)
- [åŸé¡¹ç›® GPU é…ç½®](deploy/docker-compose-5090.yml)

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ‰€æœ‰æ˜¾å¡é€šç”¨

1. **å¯ç”¨ FP16**ï¼šåœ¨ `api_server.py` ä¸­è®¾ç½® `use_fp16=True`
2. **å…³é—­å…¶ä»– GPU ç¨‹åº**ï¼šç¡®ä¿ GPU èµ„æºå……è¶³
3. **ç›‘æ§æ˜¾å­˜ä½¿ç”¨**ï¼šä½¿ç”¨ `nvidia-smi` ç›‘æ§

### RTX 50 ç³»åˆ—ä¸“å±

1. **å¢åŠ å…±äº«å†…å­˜**ï¼šå·²åœ¨é…ç½®ä¸­è®¾ç½®ä¸º 16GB
2. **å¯ç”¨å»¶è¿ŸåŠ è½½**ï¼šå·²è®¾ç½® `CUDA_MODULE_LOADING=LAZY`
3. **è€ƒè™‘å¤š GPU**ï¼šå¦‚æœæœ‰å¤šå¼  5090ï¼Œå¯ä»¥é…ç½®è´Ÿè½½å‡è¡¡

### RTX 40/30 ç³»åˆ—

1. **å¿…é¡»å¯ç”¨ FP16**ï¼šå¦åˆ™å¯èƒ½æ˜¾å­˜ä¸è¶³
2. **é€‚å½“é™ä½æ‰¹å¤„ç†å¤§å°**ï¼šå¦‚æœé‡åˆ° OOM é”™è¯¯
3. **ç›‘æ§æ¸©åº¦**ï¼šé•¿æ—¶é—´è¿è¡Œæ³¨æ„æ•£çƒ­

## ğŸ‰ æ€»ç»“

é€‰æ‹©æ­£ç¡®çš„é…ç½®æ–‡ä»¶å¯¹äºè·å¾—æœ€ä½³æ€§èƒ½è‡³å…³é‡è¦ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒæœ¬æŒ‡å—æˆ–åœ¨é¡¹ç›®ä¸­æäº¤ Issueã€‚

ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼

